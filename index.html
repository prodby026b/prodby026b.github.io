<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>prodby026b — شبکه و امنیت</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent: #00fff6;
      --bg: #000;
      --panel: rgba(0,0,0,0.7);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0;background:var(--bg);color:var(--accent);font-family:"Vazirmatn","Share Tech Mono",system-ui,sans-serif;direction:rtl}
    /* header + profile */
    .header-wrap{
      display:flex;
      align-items:center;
      gap:16px;
      max-width:980px;
      width:100%;
      padding:84px 20px 8px 20px;
      box-sizing:border-box;
      justify-content:flex-end;
    }
    .profile-pic{
      width:110px;
      height:110px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid var(--accent);
      box-shadow:0 8px 26px rgba(0,255,246,0.06);
      background:#071013;
      display:block;
    }
    .profile-placeholder{
      width:110px;
      height:110px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:3px dashed rgba(0,255,246,0.12);
      color:var(--accent);
      font-family:"Share Tech Mono",monospace;
      font-size:0.9rem;
      text-align:center;
    }
    .title-block{
      background:var(--panel);
      padding:10px 14px;
      border-radius:10px;
      border-right:3px solid var(--accent);
      box-shadow:0 6px 22px rgba(0,255,246,0.06);
    }
    h1{margin:0;font-size:1.9rem;font-family:"Share Tech Mono",monospace}
    .profile-actions{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
    .btn{
      background:transparent;border:1px solid rgba(0,255,246,0.16);color:var(--accent);padding:6px 10px;border-radius:8px;text-decoration:none;font-family:"Share Tech Mono",monospace;cursor:pointer;
    }
    .btn.small{padding:6px 8px;font-size:0.9rem}
    .hint{font-size:0.9rem;color:var(--accent);opacity:0.9;margin-top:8px}
    @media (max-width:720px){
      .header-wrap{padding:68px 12px 8px 12px}
      .profile-pic{width:80px;height:80px}
      .profile-placeholder{width:80px;height:80px;font-size:0.78rem}
      h1{font-size:1.2rem}
    }
  </style>
</head>
<body>

  <!-- Top status minimal -->
  <div style="position:fixed;top:0;right:0;left:0;height:64px;background:linear-gradient(90deg,#040404 0%,#0f1113 100%);border-bottom:1px solid rgba(0,255,246,0.12);z-index:50;display:flex;align-items:center;padding:0 18px;">
    <div style="color:var(--accent);font-family:'Share Tech Mono',monospace">© prodby026b</div>
  </div>

  <!-- Header with profile picture + controls -->
  <div class="header-wrap" role="banner" aria-label="هدر سایت">
    <div style="display:flex;align-items:center;gap:12px;flex-direction:row-reverse;">
      <!-- Profile display area -->
      <div id="profileArea" style="display:flex;flex-direction:column;align-items:center;">
        <!-- image or placeholder inserted by JS -->
        <div id="profileInner"></div>
        <div class="profile-actions" style="margin-top:8px;">
          <label class="btn small" for="profileFileInput" title="بارگذاری تصویر از دستگاه">
            آپلود عکس پروفایل
          </label>
          <button id="clearProfileBtn" class="btn small" title="حذف عکس محلی ذخیره‌شده">پاک کردن عکس محلی</button>
        </div>
      </div>

      <div class="title-block" style="text-align:right;">
        <h1>prodby026b — مهندس شبکه و امنیت</h1>
        <div style="font-size:0.95rem;color:var(--accent);opacity:0.95;margin-top:6px">مدارک: Network+, CCNA, ELPIK 1</div>
      </div>
    </div>
  </div>

  <!-- Hidden file input for local upload -->
  <input id="profileFileInput" type="file" accept="image/*" style="display:none" aria-hidden="true" />

  <main style="padding:20px;">
    <!-- rest of your site content -->
    <p style="color:var(--accent);max-width:980px;margin:140px auto 40px auto;padding:0 18px;">
      اینجا محتوا قرار می‌گیرد. عکس پروفایل می‌تواند از ریشهٔ مخزن GitHub خوانده شود (اگر آن‌جا آپلود کنید)
      یا از طریق دکمهٔ «آپلود عکس پروفایل» از سیستم شما بارگذاری و در مرورگر ذخیره شود.
    </p>
  </main>

  <script>
    // ====== CONFIG (تنظیمات) ======
    const GITHUB_OWNER = 'prodby026b';
    const GITHUB_REPO = 'prodby026b.github.io';
    const GITHUB_BRANCH = 'main'; // یا 'master' اگر شاخهٔ شما master است
    // نام‌هایی که در ریشهٔ ریپو بررسی می‌کنیم (در صورت آپلود در GitHub)
    const PROFILE_CANDIDATES = ['profile.jpg','profile.png','avatar.jpg','avatar.png','me.jpg','me.png','profile.webp','profile.jpeg'];
    // کلید localStorage برای عکس آپلود شده توسط شما
    const LOCAL_STORAGE_KEY = 'pb_profile_image_dataurl_v1';
    // =================================

    const profileInner = document.getElementById('profileInner');
    const fileInput = document.getElementById('profileFileInput');
    const clearBtn = document.getElementById('clearProfileBtn');

    // Render functions
    function renderProfileFromUrl(url, filename){
      profileInner.innerHTML = '';
      const img = document.createElement('img');
      img.className = 'profile-pic';
      img.src = url;
      img.alt = filename || 'عکس پروفایل';
      img.loading = 'lazy';
      profileInner.appendChild(img);
    }
    function renderPlaceholder(){
      profileInner.innerHTML = '';
      const ph = document.createElement('div');
      ph.className = 'profile-placeholder';
      ph.textContent = 'عکس پروفایل\nندارد';
      profileInner.appendChild(ph);
    }

    // Try localStorage first (prefer user's uploaded local image)
    function tryLoadLocalProfile(){
      try {
        const data = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (data) {
          renderProfileFromUrl(data, 'عکس آپلودی محلی');
          return true;
        }
      } catch(e){ console.warn('localStorage read error', e); }
      return false;
    }

    // Fetch profile candidates from repo root via GitHub Contents API
    async function tryFetchProfileFromRepo(){
      for (const name of PROFILE_CANDIDATES) {
        const api = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${encodeURIComponent(name)}?ref=${encodeURIComponent(GITHUB_BRANCH)}`;
        try {
          const res = await fetch(api);
          if (!res.ok) {
            if (res.status === 404) continue;
            // for other errors continue to next candidate
            continue;
          }
          const json = await res.json();
          if (json && json.download_url) {
            renderProfileFromUrl(json.download_url, name);
            return true;
          }
        } catch (e) {
          console.warn('fetch profile error for', name, e);
          continue;
        }
      }
      return false;
    }

    // Initialize: priority => localStorage (user upload) > repo file > placeholder
    (async function initProfile(){
      // If local exists, use it
      const gotLocal = tryLoadLocalProfile();
      if (gotLocal) return;

      // otherwise try repo
      const gotRepo = await tryFetchProfileFromRepo();
      if (gotRepo) return;

      // fallback
      renderPlaceholder();
    })();

    // Handle local upload
    fileInput.addEventListener('change', async function(e){
      const file = fileInput.files && fileInput.files[0];
      if (!file) return;
      // basic validation: image and reasonable size (e.g., < 5MB)
      if (!file.type.startsWith('image/')) {
        alert('لطفاً یک فایل تصویری انتخاب کنید.');
        return;
      }
      if (file.size > 8 * 1024 * 1024) {
        if (!confirm('فایل بزرگتر از 8MB است. ادامه می‌دهید؟')) return;
      }
      const reader = new FileReader();
      reader.onload = function(evt){
        const dataUrl = evt.target.result;
        try {
          localStorage.setItem(LOCAL_STORAGE_KEY, dataUrl);
        } catch(err){
          console.warn('Cannot save image in localStorage:', err);
          alert('ذخیره‌سازی محلی ممکن نیست (حافظهٔ مرورگر پر یا تنظیمات محدود). تصویر فقط برای همین جلسه نمایش داده می‌شود.');
        }
        renderProfileFromUrl(dataUrl, file.name);
      };
      reader.readAsDataURL(file);
    });

    // Clear local profile
    clearBtn.addEventListener('click', function(){
      if (!confirm('آیا مطمئن هستید که می‌خواهید عکس پروفایل ذخیره‌شده محلی را پاک کنید؟')) return;
      try {
        localStorage.removeItem(LOCAL_STORAGE_KEY);
        // After clearing, try to load from repo; if not present, show placeholder
        (async function(){
          const gotRepo = await tryFetchProfileFromRepo();
          if (!gotRepo) renderPlaceholder();
        })();
      } catch(e){
        console.warn('clear localStorage failed', e);
        alert('پاک‌سازی انجام نشد.');
      }
    });

    // Accessibility: allow label click to open file chooser
    // (label already wired via for="profileFileInput")

  </script>
</body>
</html>
